# Coordinator Environment Configuration
# ======================================
# This file documents all environment variables required for the coordinator
# server running on the production EC2 instance (44.193.31.120).
#
# Rename this file to .env and place in /opt/gymnastics-graphics/server/
# DO NOT commit the actual .env file with real credentials.
#
# Usage on coordinator:
#   1. Copy to /opt/gymnastics-graphics/server/.env
#   2. Ensure firebase-service-account.json is in place
#   3. Start with: pm2 start ecosystem.config.js

# =============================================================================
# NODE ENVIRONMENT
# =============================================================================

# Application environment mode
# - "production": Optimized for production use, minimal logging
# - "development": Verbose logging, hot reload enabled
NODE_ENV=production

# Server port
# The coordinator listens on this port for HTTP requests
# Default: 3001
PORT=3001

# =============================================================================
# FIREBASE CONFIGURATION
# =============================================================================

# Firebase Realtime Database URL
# The central database for competition data, VM pool state, and alerts
FIREBASE_DATABASE_URL=https://gymnastics-graphics-default-rtdb.firebaseio.com

# Path to Firebase service account credentials JSON file
# This file authenticates the coordinator with Firebase Admin SDK
# On coordinator: /opt/gymnastics-graphics/firebase-service-account.json
# Locally: ./firebase-service-account.json (relative to server/)
GOOGLE_APPLICATION_CREDENTIALS=/opt/gymnastics-graphics/firebase-service-account.json

# =============================================================================
# AWS CONFIGURATION
# =============================================================================

# AWS region for EC2 operations
# The coordinator manages VM pool instances in this region
# All gymnastics-graphics VMs are in us-east-1
AWS_REGION=us-east-1

# AWS credentials (optional - use IAM role on EC2 instead)
# The coordinator EC2 instance should use an IAM instance profile
# with permissions for EC2 operations. Only set these for local testing.
# AWS_ACCESS_KEY_ID=your-access-key-id
# AWS_SECRET_ACCESS_KEY=your-secret-access-key

# =============================================================================
# COORDINATOR MODE
# =============================================================================

# Enable coordinator mode
# When true, the server operates as the central coordinator:
# - Manages VM pool (start/stop/assign/release)
# - Monitors VM health across all instances
# - Handles alert aggregation
# - Tracks activity for auto-shutdown
# When false, operates as a standard show controller VM
COORDINATOR_MODE=true

# =============================================================================
# AUTO-SHUTDOWN CONFIGURATION
# =============================================================================

# Minutes of inactivity before auto-shutdown
# The coordinator tracks lastActivity timestamp. When idle time exceeds
# this threshold, the coordinator initiates graceful shutdown:
# 1. Emits 'shutdownPending' socket event to all clients
# 2. Waits 30 seconds for any cancellation
# 3. Calls EC2 StopInstances on its own instance
#
# Set to 0 to disable auto-shutdown
# Default: 120 (2 hours)
AUTO_SHUTDOWN_MINUTES=120

# =============================================================================
# OBS CONFIGURATION (Optional)
# =============================================================================

# OBS WebSocket connection settings
# The coordinator may not need OBS connection directly, but these are
# included for completeness. Individual VMs have their own OBS settings.
# OBS_WEBSOCKET_URL=ws://localhost:4455
# OBS_WEBSOCKET_PASSWORD=your-obs-password

# =============================================================================
# LOGGING
# =============================================================================

# Log level for the application
# Options: error, warn, info, debug, verbose
# Default: info (production), debug (development)
# LOG_LEVEL=info

# =============================================================================
# ADDITIONAL NOTES
# =============================================================================
#
# Production Deployment:
# ----------------------
# 1. The coordinator runs on EC2 instance i-001383a4293522fa4
# 2. Accessible at https://api.commentarygraphic.com
# 3. SSL handled by Let's Encrypt (auto-renewal via certbot)
# 4. PM2 manages the Node.js process (see ecosystem.config.js)
# 5. Nginx reverse proxies port 443 to port 3001
#
# IAM Permissions Required:
# -------------------------
# The coordinator's IAM role (coordinator-role) needs:
# - ec2:DescribeInstances (for VM pool status)
# - ec2:StartInstances (for starting VMs)
# - ec2:StopInstances (for stopping VMs and self-shutdown)
# - ec2:RunInstances (for launching new VMs)
# - ec2:TerminateInstances (for terminating VMs)
# - ec2:CreateTags (for tagging new VMs)
#
# Firebase Permissions Required:
# ------------------------------
# The service account needs read/write access to:
# - competitions/{compId}/config
# - competitions/{compId}/production
# - vmPool/{vmId}
# - alerts/{compId}
#
# Troubleshooting:
# ----------------
# - Check PM2 logs: pm2 logs coordinator
# - Check status: curl http://localhost:3001/api/status
# - Check coordinator status: curl http://localhost:3001/api/coordinator/status
# - View error logs: tail -f /opt/gymnastics-graphics/server/logs/coordinator-error.log
